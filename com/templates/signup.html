<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>西安理工大学竞赛管理系统-注册</title>
    <meta name="description" content="西安理工大学统一竞赛管理平台-注册">
    <meta name="keywords" content="西安理工大学,竞赛管理,竞赛系统,西安理工大学竞赛管理系统">
    <link rel="shortcut icon" href="../static/favicon.ico">
    <link rel="stylesheet" href="../static/css/base.css">
    <link rel="stylesheet" href="../static/css/signup.css">
    <link rel="stylesheet" href="../static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/layui/css/layui.css">
    <script src="../static/js/jquery-3.6.0.min.js"></script>
    <script src="../static/bootstrap/js/bootstrap.min.js"></script>
    <style>
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
        }
    </style>
</head>
<body>
<form action="{% url 'signup' %}" method="POST" enctype="multipart/form-data" onsubmit="return checkPassword(this)">
    {% csrf_token %}
    <div class="container-fluid">
        <div class="row background" style="height: 150px;">
            <div class="col-md-2 white-font"></div>
            <div class="col-md-6 white-font plus">
                <span>西安理工大学竞赛管理系统</span>
            </div>
            <div class="col-md-4 white-font ">
                <a href="{% url 'login' %}" class="white-font">已有账号，立刻登录</a>
            </div>
        </div>
    </div>


    <div class="container-fluid col-red background">
        <div class="tell-font">
            <span>* 注册分为3步，分别为【选择身份】、【填写信息】、【创建账户】，三步完成后，才能成功创建一个账户。</span><br>
            <span>* 谨慎选择用户身份，一经选择不得更改。</span>
        </div>

    </div>
    <!--跳转的头-->
    <div class="background marl">
        <ul class="nav nav-tabs" id="mar" role="tablist">
            <li role="presentation" class="limit  active all-head">
                <a href="#home" class="wid-mid" aria-controls="home" role="tab" data-toggle="tab"
                   style="padding-left: 120px;">
                    一、选择身份
                </a>
            </li>
            <li role="presentation" class="all-head">
                <a href="#profile-student" class="wid-mid" aria-controls="profile-teacher" role="tab" data-toggle="tab"
                   id="must1"
                   style="padding-left: 120px">
                    二、填写信息
                </a>
            </li>
            <li role="presentation" class="all-head">
                <a href="#messages" class="wid-mid" aria-controls="messages" role="tab" data-toggle="tab" id="must2"
                   style="padding-left: 120px">
                    三、创建用户
                </a>
            </li>
        </ul>
    </div>

    <input type="radio" name="type" value="student" style="display: none">
    <input type="radio" name="type" value="teacher" style="display: none">

    <div>
        <!-- Tab panes -->
        <div class="tab-content">
            <!--第一个页面-->
            <div role="tabpanel" class="tab-pane active" id="home">
                <div class="null"></div>
                <div class="for-org">请选择您的身份</div>
                <a href="#" id="student">
                    <div class="role-type">
                        <div class="brod brod-green">
                            <span class="glyphicon glyphicon-grain font-green" id="green-icon"></span>
                        </div>
                        <button type="button" class="font-green brod-green" id="green-btn">我是参赛队员</button>

                    </div>
                </a>
                <a href="#" id="teacher">
                    <div class="role-type">
                        <div class="brod brod-blue">
                            <span class="glyphicon glyphicon-tree-deciduous font-blue" id="blue-icon"></span>
                        </div>
                        <button type="button" class="font-blue brod-blue" id="blue-btn">我是指导教师</button>
                    </div>
                </a>
            </div>
            <!--第二个页面 -- 学生-->
            <div role="tabpanel" class="tab-pane" id="profile-student">
                <div class="null"></div>
                <div class="for-org">填写信息（参赛队员）</div>
                <div class="col-xs-2"></div>
                <div class="form-inline stu">
                    <div class="col-xs-4">
                        <div class="form-group">
                            <label for="student-name" style="margin-left: 55px">姓名</label>
                            <input type="text" class="form-control" id="student-name" placeholder="Name" name="s_name">
                        </div>

                        <div class="form-group">
                            <label style="margin-left: 55px">性别</label>
                            <label class="radio-inline">
                                <input type="radio" name="s_sex" id="student-nan" value="1"> 男
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="s_sex" id="student-nv" value="0"> 女
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="student-card">身份证件类型</label>
                            <select class="form-control" id="student-card" name="s_certification_type">
                                <option value="1">中华人民共和国居民身份证</option>
                                <option value="2">军人证件</option>
                                <option value="3">港澳台身份证件</option>
                                <option value="4">华侨身份证</option>
                                <option value="5">外籍护照</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="student-InputID">身份证件号码</label>
                            <input type="text" class="form-control" id="student-InputID" placeholder="ID number"
                                   name="s_id_number">
                        </div>

                        <div class="form-group">
                            <label for="student-date" style="margin-left: 27px">出生日期</label><input type="date"
                                                                                                   id="student-date"
                                                                                                   name="s_birthday"
                                                                                                   placeholder="Birthday"
                                                                                                   class="form-control"
                                                                                                   style="width: 205px"
                                                                                                   readonly>
                        </div>

                        <div class="form-group">
                            <label for="student-type" style="margin-left: 27px">政治面貌</label>
                            <select class="form-control" id="student-type" name="s_politics_status">
                                <option value="1">中共党员</option>
                                <option value="2">中共预备党员</option>
                                <option value="3">共青团员</option>
                                <option value="4">群众</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="student-email" style="margin-left: 27px">电子邮箱</label>
                            <input type="email" class="form-control" id="student-email" placeholder="E-mail"
                                   name="s_mail">
                        </div>
                        <div class="form-group">
                            <label for="student-phone" style="margin-left: 27px">电话号码</label>
                            <input type="tel" class="form-control" id="student-phone" maxlength="11" minlength="11"
                                   placeholder="Phone" name="s_phone" data-content="此用户已注册！" data-toggle="popover"
                                   data-placement="bottom"/>
                        </div>
                    </div>
                    <div class="col-xs-5">
                        <div class="form-group">
                            <label for="student-img-input" style="margin-left: 60px">照片</label>
                            <img src="../static/images/none.png" alt="#" class="img-rounded reading">
                            <input type="file" id="student-img-input" accept='image/*' name="s_picture">
                        </div>

                        <div class="form-group">
                            <label for="student-college" style="margin-left: 55px">学院</label>
                            <select name="s_college" id="student-college" class="form-control">
                                <option value="材料科学与工程学院">材料科学与工程学院</option>
                                <option value="机械与精密仪器工程学院">机械与精密仪器工程学院</option>
                                <option value="自动化与信息工程学院">自动化与信息工程学院</option>
                                <option value="水利水电学院">水利水电学院</option>
                                <option value="印刷包装与数字媒体学院">印刷包装与数字媒体学院</option>
                                <option value="经济与管理学院">经济与管理学院</option>
                                <option value="理学院">理学院</option>
                                <option value="人文与外国语学院">人文与外国语学院</option>
                                <option value="计算机科学与工程学院">计算机科学与工程学院</option>
                                <option value="土木建筑工程学院">土木建筑工程学院</option>
                                <option value="艺术与设计学院">艺术与设计学院</option>
                                <option value="马克思主义学院">马克思主义学院</option>
                                <option value="电气工程学院">电气工程学院</option>
                                <option value="国际工学院">国际工学院</option>
                                <option value="研究生院">研究生院</option>
                            </select>

                        </div>
                        <div class="form-group">
                            <label for="student-grade" style="margin-left: 55px">年级</label>
                            <input type="text" class="form-control" id="student-grade" placeholder="Grade"
                                   name="s_grade">
                        </div>
                        <div class="form-group">
                            <label for="student-class" style="margin-left: 55px">班级</label>
                            <input type="text" class="form-control" id="student-class" placeholder="Class"
                                   name="s_class">
                        </div>
                        <div class="form-group">
                            <label for="student-id" style="margin-left: 55px">学号</label>
                            <input type="number" class="form-control" id="student-id" placeholder="Student id"
                                   name="s_number">
                        </div>
                    </div>
                    <div class="col-xs-10">
                        <button type="button" class="btn btn-primary pri-btn fir">上一步</button>
                        <button type="button" class="btn btn-primary pri-btn" id="stu-btn">下一步</button>
                    </div>
                </div>
            </div>
            <!--第二个页面 -- 老师-->
            <div role="tabpanel" class="tab-pane" id="profile-teacher">
                <div class="null"></div>
                <div class="for-org">填写信息（指导教师）</div>
                <div class="col-xs-2"></div>
                <div class="form-inline tea">
                    <div class="col-xs-4">
                        <div class="form-group">
                            <label for="exampleInputName2" style="margin-left: 55px">姓名</label>
                            <input type="text" class="form-control" id="exampleInputName2" placeholder="Name"
                                   name="t_name">
                        </div>
                        <div class="form-group" id="block">
                            <label style="margin-left: 55px">性别</label>
                            <label class="radio-inline">
                                <input type="radio" name="t_sex" id="tea-nan" value="1"> 男
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="t_sex" id="tea-nv" value="0"> 女
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="card">身份证件类型</label>
                            <select class="form-control" id="card" name="t_politics_status">
                                <option value="1">中华人民共和国居民身份证</option>
                                <option value="2">军人证件</option>
                                <option value="3">港澳台身份证件</option>
                                <option value="4">华侨身份证</option>
                                <option value="5">外籍护照</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="InputID">身份证件号码</label>
                            <input type="text" class="form-control" id="InputID" placeholder="ID number"
                                   name="t_id_number">
                        </div>

                        <div class="form-group">
                            <label for="date" style="margin-left: 30px">出生日期</label><input type="date" id="date"
                                                                                           name="t_birthday" value=""
                                                                                           placeholder="Birthday"
                                                                                           class="form-control"
                                                                                           style="width: 205px"
                                                                                           readonly>
                        </div>

                        <div class="form-group">
                            <label for="type" style="margin-left: 27px">行政职务</label>
                            <select class="form-control" id="type" name="t_position">
                                <option value="0">无</option>
                                <option value="1">校长</option>
                                <option value="2">副校长</option>
                                <option value="3">校长助理</option>
                                <option value="4">院长</option>
                                <option value="5">副院长</option>
                                <option value="6">院长助理</option>
                                <option value="7">处长</option>
                                <option value="8">副处长</option>
                                <option value="9">处长助理</option>
                                <option value="10">部长</option>
                                <option value="11">副部长</option>
                                <option value="12">部长助理</option>
                                <option value="13">主任</option>
                                <option value="14">副主任</option>
                                <option value="15">主任助理</option>
                                <option value="16">所长</option>
                                <option value="17">副所长</option>
                                <option value="18">所长助理</option>
                                <option value="19">系主任</option>
                                <option value="20">副系主任</option>
                                <option value="21">系主任助理</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="email" style="margin-left: 27px">电子邮箱</label>
                            <input type="email" class="form-control" id="email" placeholder="E-mail" name="t_mail">
                        </div>
                        <div class="form-group">
                            <label for="phone" style="margin-left: 27px">电话号码</label>
                            <input type="tel" class="form-control" id="phone" maxlength="11" minlength="11"
                                   placeholder="Phone" name="t_phone" data-content="此用户已注册！" data-toggle="popover"
                                   data-placement="bottom"/>
                        </div>
                    </div>
                    <div class="col-xs-5">
                        <div class="form-group">
                            <label for="teacher-img-input" style="margin-left: 60px">照片</label>
                            <img src="../static/images/none.png" alt="#" class="img-rounded reading">
                            <input type="file" id="teacher-img-input" accept='image/*' name="picture">
                        </div>

                        <div class="form-group">
                            <label for="college" style="margin-left: 55px">学院</label>
                            <select name="t_college" id="college" class="form-control">
                                <option value="材料科学与工程学院">材料科学与工程学院</option>
                                <option value="机械与精密仪器工程学院">机械与精密仪器工程学院</option>
                                <option value="自动化与信息工程学院">自动化与信息工程学院</option>
                                <option value="水利水电学院">水利水电学院</option>
                                <option value="印刷包装与数字媒体学院">印刷包装与数字媒体学院</option>
                                <option value="经济与管理学院">经济与管理学院</option>
                                <option value="理学院">理学院</option>
                                <option value="人文与外国语学院">人文与外国语学院</option>
                                <option value="计算机科学与工程学院">计算机科学与工程学院</option>
                                <option value="土木建筑工程学院">土木建筑工程学院</option>
                                <option value="艺术与设计学院">艺术与设计学院</option>
                                <option value="马克思主义学院">马克思主义学院</option>
                                <option value="电气工程学院">电气工程学院</option>
                                <option value="国际工学院">国际工学院</option>
                                <option value="研究生院">研究生院</option>
                                <option value="继续教育学院">继续教育学院</option>
                                <option value="体育教学部">体育教学部</option>
                                <option value="工程训练中心">工程训练中心</option>
                                <option value="职业培训学院">职业培训学院</option>
                            </select>


                        </div>
                        <div class="form-group">
                            <label for="grade" style="margin-left: 55px">职称</label>
                            <select class="form-control" id="grade" name="t_title">
                                <option value="1">无</option>
                                <option value="2">高级</option>
                                <option value="3">副高级</option>
                                <option value="4">中级</option>
                                <option value="5">初级</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="department" style="margin-left: 40px">所在系</label>
                            <input type="text" class="form-control" id="department" placeholder="Department"
                                   name="t_department">
                        </div>
                        <div class="form-group">
                            <label for="teacher-id" style="margin-left: 30px">教职工号</label>
                            <input type="number" class="form-control" id="teacher-id" placeholder="Teacher id"
                                   name="t_number">
                        </div>
                    </div>
                    <div class="col-xs-10">
                        <button type="button" class="btn btn-primary pri-btn fir">上一步</button>
                        <button type="button" class="btn btn-primary pri-btn" id="tea-btn">下一步</button>
                    </div>
                </div>
            </div>
            <!--第三个页面-->
            <div role="tabpanel" class="tab-pane" id="messages">
                <div class="null"></div>
                <div class="for-org">创建用户</div>
                <div class="row">
                    <div class="col-md-3"></div>
                    <div class="col-md-4">
                        <div class="input-group input-group-lg pri">
                            <span class="input-group-addon glyphicon glyphicon-user"></span>
                            <input type="text" class="form-control disabled" placeholder="Username" id="username"
                                   disabled aria-describedby="basic-addon1">
                        </div>
                        <div class="input-group input-group-lg">
                            <span class="input-group-addon glyphicon glyphicon-lock"></span>
                            <input type="password" class="form-control" id="password" placeholder="Password"
                                   aria-describedby="basic-addon1">
                        </div>
                        <div class="input-group input-group-lg">
                            <span class="input-group-addon glyphicon glyphicon-lock"></span>
                            <input type="password" class="form-control" id="passwordagain" placeholder="Password again"
                                   aria-describedby="basic-addon1" name="password">
                        </div>
                    </div>
                    <div class="col-md-5"></div>
                    <div class="col-xs-10">
                        <button type="button" class="btn btn-primary pri-btn sec">上一步</button>
                        <button type="submit" class="btn btn-primary pri-btn" id="submit">完成</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
</body>
<script src="../static/js/layer/layer.js"></script>
<script src="../static/layui/layui.js"></script>
<script src="../static/js/signup.js"></script>
<script type="text/javascript">
    $('#student-phone').on('blur', () => {
        $.getJSON('{% url 'checkIn' %}', {'phone': $('#student-phone').val()}, (args) => {
            if (args.code === 1) {
                $('#student-phone').popover('show');
                document.getElementById('stu-btn').setAttribute('disabled', 'disabled');
            } else {
                $('#student-phone').popover('hide');
                document.getElementById('stu-btn').removeAttribute('disabled');
            }
        })
    })

    $('#phone').on('blur', () => {
        $.getJSON('{% url 'checkIn' %}', {'phone': $('#phone').val()}, (args) => {
            if (args.code === 1) {
                $('#phone').popover('show');
                document.getElementById('tea-btn').setAttribute('disabled', 'disabled');
            } else {
                $('#phone').popover('hide')
                document.getElementById('tea-btn').removeAttribute('disabled');
            }
        })
    })

</script>
<script type="text/javascript">
    function checkPassword(form) {
        let password = $("#password");
        let password_again = $("#passwordagain");
        //密码正则，4到16位（字母，数字，下划线，减号）
        let uPattern = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[~!@#$%^&*()_+`\-={}:";'<>?,.\/]).{8,16}$/;
        if (password.length < 8 || password.length > 16 || !uPattern.test(password)) {
            layer.alert('请输入8-16位数字,字母,字符的组合', {
                icon: 2,
                skin: 'layer-ext-demo' //见：扩展说明
            })
            return false;
        }
        if (password.val() !== password_again.val()) {
            layer.alert('请两次输入一样的密码!', {
                icon: 2,
                skin: 'layer-ext-demo' //见：扩展说明
            })
            return false;
        }
        return true;
    }

    let PHONE = 0;
    // 开始student输入信息格式限制
    $("#stu-btn").bind('click', function () {
        let sex_obj = document.getElementsByName('s_sex');
        if (sex_obj[0].checked !== true && sex_obj[1].checked !== true) {
            layer.msg('选择性别!')
            return;
        }
        let element = document.querySelectorAll('.stu .form-group input');
        if (element[7].value === '') {
            layer.msg('请上传照片')
            return;
        }
        for (let i = 0; i < element.length; i++) {
            if (element[i].value === '') {
                layer.msg('请填写完整信息!')
                return;
            }
        }
        // 身份证正则
        let cP = /^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/;
        if ($('#student-card').val() === '1' && !cP.test($('#student-InputID').val())) {
            layer.msg('身份证格式错误!');
            return;
        }
        // 手机号码正则
        let mPattern = /^((13[0-9])|(14[5|7])|(15([0-3]|[5-9]))|(18[0,5-9]))\d{8}$/;
        if (!mPattern.test($('#student-phone').val())) {
            layer.msg('手机号码格式错误！');
            return;
        }
        //Email正则
        let ePattern = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
        if (!ePattern.test($('#student-email').val())) {
            layer.msg('邮箱格式错误！');
            return;
        }
        body[1].classList.remove('active');
        body[3].classList.add('active');
        head[2].classList.add('active');
        head[1].classList.remove('active');
        $("#username").val(element[6].value);
    })
    let FLAG = 0;  // 学生注册标记 如果是学生则进入学生信息界面
    $('#tea-btn').bind('click', function () {
        let sex_tea = document.getElementsByName('t_sex');
        if (sex_tea[0].checked !== true && sex_tea[1].checked !== true) {
            layer.msg('选择性别!', {})
            return;
        }
        let teacher_data = document.querySelectorAll('.tea .form-group input');
        if (teacher_data[7].value === '') {
                layer.msg('请上传照片', {})
                return;
            }
        for (let i = 0; i < teacher_data.length; i++) {
            if (teacher_data[i].value === '') {
                layer.msg('请填写完整信息!', {})
                return;
            }
        }
        // 身份证正则
        let cP = /^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/;
        if ($('#card').val() === '1' && !cP.test($('#InputID').val())) {
            layer.msg('身份证格式错误!');
            return;
        }
        // 手机号码正则
        let mPattern = /^((13[0-9])|(14[5|7])|(15([0-3]|[5-9]))|(18[0,5-9]))\d{8}$/;
        if (!mPattern.test($('#phone').val())) {
            layer.msg('手机号码格式错误！');
            return;
        }
        //Email正则
        let ePattern = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
        if (!ePattern.test($('#email').val())) {
            layer.msg('邮箱格式错误！');
            return;
        }
        body[2].classList.remove('active');
        body[3].classList.add('active');
        head[2].classList.add('active');
        head[1].classList.remove('active');
        FLAG = 1;
        $("#username").val(teacher_data[6].value);
    })

    $('.fir').bind('click', function () {
        body[2].classList.remove('active');
        body[1].classList.remove('active');
        body[0].classList.add('active');
        head[1].classList.remove('active');
        head[0].classList.add('active');
    })
    $('.sec').bind('click', function () {
        head[2].classList.remove('active');
        head[1].classList.add('active');
        body[3].classList.remove('active');
        if (FLAG === 0) {
            body[1].classList.add('active');
        } else {
            body[2].classList.add('active');
        }
    })
    // 取消第三个a标签的使用
    document.getElementById("must1").href = "javascript:void(0)";
    document.getElementById("must2").href = "javascript:void(0)";
</script>
</html>